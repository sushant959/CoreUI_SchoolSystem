
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>CompanyRegistration</title>
    <link rel="icon" type="image/x-icon" href="@Url.Content("~/content/favicon.ico")" />
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/Scripts/jquery.serializejson.min.js"></script>
    <title>CompanyRegistration</title>
    <style>
        input {
            min-width: 50px;
        }

        [class^="error_"] {
            font-size: small;
            font-style: italic;
            color: red;
            flex: 2;
        }
    </style>
</head>
<body>
    <div class="navbar navbar-inverse navbar-fixed-top" style="background-color:brown; border-color:silver">
        <div style="display:flex">
            <div style="margin:10px;">
                @*<img src="~/Content/ambulance1.jpg" height="50" style="margin-left:15px" />*@
                <i class="fa fas fa-school" style="color:white; font-size:48px !important"></i>
            </div>
            <div style="color:whitesmoke;margin-left:20px;">
                <h4 style="margin-bottom:5px">....................</h4>
                <span>...........................</span>

            </div>

        </div>
        @*<input type="button" onclick="location.href='/Home/AmbulanceRegistration'" value="Ambulance Registration" class="pull-right" style="color:white;background-color:darkcyan" />*@
    </div><br /><br />
    <div class="col-sm-8 col-sm-offset-2">
        <div>
            <div style="width:99%">
                <div class="panel panel-default" style="background-color:floralwhite !important;">
                    <div class="panel-heading" id="" style="background-color:darkgray">Company Registration Form</div>
                    <div class="panel-body" style="background-color:transparent">
                        <form id="formCompanyRegistration">
                            <div class="row">
                                <div class="col-sm-4">
                                    <h4 style="color:brown">Company Details</h4>
                                </div>
                            </div>
                            <div class="flexContainer">
                                <input type="hidden" name="ID" />

                                <label style="flex:1.2">Company Name:&nbsp;*</label>
                                <input type="text" class="form-control" name="Name" style="flex:2" placeholder="Required" required />&nbsp;&nbsp;&nbsp;&nbsp;
                                <label style="flex:1.3">PAN No.*:&nbsp;&nbsp;</label>
                                <input type="text" class="form-control" name="PAN" style="flex:2"  placeholder="Required" required />&nbsp;&nbsp;&nbsp;&nbsp;
                            </div><br />
                            <div class="flexContainer">
                                <label style="flex:1.2">Address:&nbsp;*</label>
                                <input type="text" class="form-control" name="Address" style="flex:2" placeholder="Required" required />&nbsp;&nbsp;&nbsp;&nbsp;
                                <label style="flex:1.3">Mobile No.*:&nbsp;&nbsp;</label>
                                <input type="text" class="form-control" name="PhoneNo" style="flex:2" onkeypress="return isNumberKey(event)" placeholder="Required" required />&nbsp;&nbsp;&nbsp;&nbsp;
                            </div><br />
                            <div class="row">
                                <div class="col-sm-4">
                                    <h4 style="color:brown">Login Details</h4>
                                </div>
                            </div>
                            <div class="flexContainer">
                                <label style="width:138px;">EmailId:&nbsp;*</label>
                                <input type="text" class="form-control" name="Users[Email]" id="email" style="width:255px;" placeholder="Required" required />&nbsp;&nbsp;&nbsp;&nbsp;

                            </div>
                            <div class="flexContainer">
                                <label style="flex:1.2"></label>
                                <span style="flex:2">
                                    <label id="error_email" style="color: red;"></label>
                                </span>
                                <label style="flex:1.2"></label>
                                <span style="flex:2">
                                    <label></label>
                                </span>
                            </div><br />
                            <div class="flexContainer">
                                <label style="flex:1.2">Create Password:&nbsp;*</label>
                                <input type="password" class="form-control" name="Users[Password]" style="flex:2" id="password" placeholder="Required" required />&nbsp;&nbsp;&nbsp;&nbsp;
                                <label style="flex:1.3">Confirm Password.*:&nbsp;&nbsp;</label>
                                <input type="password" class="form-control" name="ConfirmPassword" id="confirmpassword" style="flex:2" placeholder="Required" required />&nbsp;&nbsp;&nbsp;&nbsp;
                            </div>
                            <div class="flexContainer">
                                <label style="flex:1.2"></label>
                                <span style="flex:2">
                                    <label></label>
                                </span>
                                <label style="flex:1.2"></label>
                                <span style="flex:2">
                                    <label id="error" style="color: red;"></label>
                                </span>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-12 text-center">
                                    <input type="submit" value="Submit" class="btn btn-success" id="btnsubmit" />
                                    <input type="button" class="btn btn-danger" id="btnCancel" onclick="cancel()" value="Cancel" />
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" id="modalCancel"
         data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog modal-sm">
            <div class="modal-content" style="background-color:floralwhite !important;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"> &times; </button>
                    <h4 class="modal-title" id="modal-title1">Info</h4>
                </div>
                <div class="modal-body" id="modal-body1">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-warning modalclose" id="btnCancelModal" style="width:100px">Yes</button>
                    <button type="button" class="btn btn-danger" id="close" data-dismiss="modal" style="width:100px">No</button>

                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" tabindex="-1" id="modalInfo"
         data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close redirect" data-dismiss="modal"> &times; </button>
                    <h4 class="modal-title" id="modal-title">Info</h4>
                </div>
                <div class="modal-body" id="modal-body">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger redirect" id="close" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
<script>
    function isNumberKey(evt) {
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode != 46 && charCode > 31
            && (charCode < 48 || charCode > 57))
            return false;
        return true;
    }

    $("#email").keyup(function () {

        var email = $("#email").val();
        var filter = /^([a-zA-Z0-9_\.\-])+\@@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

        if (!filter.test(email)) {
            //alert('Please provide a valid email address');
            $("#error_email").text("Please enter valid email");

            email.focus;
            //return false;
        } else {
            $("#error_email").text("");

        }

    });

    $("#confirmpassword").keyup(function () {
        debugger;
        var password = $("#password").val();
        var conPassword = $("#confirmpassword").val();
        if (conPassword == password) {
            $("#error").text("password match");
            $("#error").css("color", "green");
        }
        else {
            $("#error").text("password donot match");
            $("#error").css("color", "red");
        }
    })

    var cancel = function () {
        //debugger;
        $('#modalCancel').modal('show');
        $('#modal-title1').html("Confirm");
        $('#modal-body1').html("Are you sure you want to Cancel ?");
    }
    $("#btnCancelModal").on('click', function () {
        //debugger;
        $('#modalCancel').modal('hide');
        location.href = "/Home/LoginPage";
        //debugger;
    });

    $("#btnsubmit").on('click', function (e) {
        e.preventDefault();
        debugger;
        var fd = $("#formCompanyRegistration").serializeJSON();
        if (fd.Name == '' || fd.PhoneNo == '' || fd.Users.EmailId == '' || fd.Users.Password == '' || fd.ConfirmPassword == '') {
            alert("Please Provide Required Field");
            return;
        }

        if (fd.Users.Password != fd.ConfirmPassword) {
            alert("Password dont match");
            return;
        }
        
        CheckEmailId(fd);
    })


    var CheckEmailId = function (fd) {
        $.ajax({
            url: "/api/CheckCompanyEmailId",
            method: "POST",
            data: {
                EmailId: fd.Users.Email
            },
            dataType: "json",
            success: function (result) {
                debugger;
                if (result == true) {
                    $.ajax({
                        url: "/api/PostCompanyDetails",
                        method: "POST",
                        data: fd,
                        dataType: "json",
                        success: function (result) {
                            $('#modalInfo').modal('show');
                            $('#modalInfo .modal-title').html("Success");
                            $('#modalInfo .modal-body').html("Company Registered Successfully!<br/>Please Login with EmailId <b>" + fd.Users.Email +"</b>");
                            $(".redirect").on('click', function () {

                                $('#modalInfo').modal('hide');
                                $("#formCompanyRegistration").find("input[type=text],input[type=password]").val("");
                                $("#error_email").text("");
                                $("#error").text("");
                                location.href = "/Home/LoginPage";

                            })
                        },
                        error: function (e) {

                        }
                    })
                }
                else if (result == false) {
                    alert("This emailId already registered");
                    $("#formCompanyRegistration").find("input[type=text],input[type=password]").val("");
                    $("#error_email").text("");
                    $("#error").text("");
                    return;
                }
            },
            error: function (e) {

            }
        })
    }
</script>